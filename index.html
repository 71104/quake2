<!DOCTYPE html><html lang=en><head><style>/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */img,legend{border:0}legend,td,th{padding:0}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,optgroup,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre,textarea{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}table{border-collapse:collapse;border-spacing:0}
body,html{margin:0;border:none;padding:0;overflow:hidden}canvas#canvas{position:absolute;width:100%;height:100%}</style><script src=js/jquery-3.2.1.min.js></script><script>const Quake2={};Quake2.inherit=function(e,t){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},Quake2.Loader=function(){},Quake2.Loader._WEAPON_MODELS=["weapons/v_bfg","weapons/v_blast","weapons/v_chain","weapons/v_disint","weapons/v_flareg","weapons/v_handgr","weapons/v_hyperb","weapons/v_launch","weapons/v_machn","weapons/v_rail","weapons/v_rocket","weapons/v_shotg","weapons/v_shotg2"],Quake2.Loader.prototype._loadHash=function(e){const t=Object.keys(e);return Promise.all(t.map(function(t){return Promise.resolve(e[t])})).then(function(e){const i=Object.create(null);return t.forEach(function(t,n){i[t]=e[n]}),i})},Quake2.Loader.prototype.loadData=function(e){return Promise.resolve($.getJSON("baseq2/"+e+".json"))},Quake2.Loader.prototype.loadImage=function(e){return new Promise(function(t,i){const n=new Image;n.onload=function(){n.onload=null,n.onerror=null,t(n)},n.onerror=function(){n.onload=null,n.onerror=null,i(new Error("Failed to load "+e))},n.src="baseq2/"+e})},Quake2.Loader.prototype.loadImages=function(e){return Promise.all(e.map(function(e){return this.loadImage(e)},this))},Quake2.Loader.prototype.loadTexture=function(e){return this.loadImage("textures/"+e+".png")},Quake2.Loader.prototype.loadTextures=function(e){return this.loadImages(e.map(function(e){return"textures/"+e+".png"}))},Quake2.Loader.prototype.loadSkins=function(e){return Promise.all(e.map(function(e){return this.loadImage(e+".png")},this)).then(function(t){const i=Object.create(null);return e.forEach(function(e,n){i[e]=t[n]}),i})},Quake2.Loader.prototype.loadModel=function(e){const t={};return this.loadData("models/"+e+"/tris").then(function(e){return t.data=e,this.loadSkins(e.skin.names)}.bind(this)).then(function(e){return t.skins=e,t}.bind(this))},Quake2.Loader.prototype._loadEntityModels=function(e){const t=Object.create(null);Quake2.Loader._WEAPON_MODELS.forEach(function(e){t[e]=!0}),e.filter(function(e){return e.classname in Quake2.Entities.dictionary},this).forEach(function(e){Quake2.Entities.dictionary[e.classname].MODELS.forEach(function(e){t[e]=!0},this)},this);for(var i in t)t[i]=this.loadModel(i);return this._loadHash(t)},Quake2.Loader.prototype.loadMap=function(e){return this._loadHash({data:this.loadData("maps/"+e),colormap:this.loadImage("pics/colormap.png"),texture:this.loadImage("maps/"+e+".png"),normals:this.loadData("normals")}).then(function(e){const t=e.data.entities;return this._loadEntityModels(t).then(function(t){return e.models=t,e})}.bind(this))},Quake2.Physics={},Quake2.Physics.cross=function(e,t,i,n){const a=e.y*n-e.z*i,s=e.z*t-e.x*n,o=e.x*i-e.y*t;e.x=a,e.y=s,e.z=o},Quake2.Physics.clip=function(e,t,i,n,a){Quake2.Physics.cross(t,i,n,a),Quake2.Physics.cross(t,i,n,a),t.x=-t.x,t.y=-t.y,t.z=-t.z},Quake2.Entities={dictionary:Object.create(null)},Quake2.Cluster=function(e,t,i){this._gl=e;var n=[],a=[],s=[],o=[],r=[];const m=function(e,i,m){n.push(t.vertices[3*e],t.vertices[3*e+1],t.vertices[3*e+2]),i<0?a.push(-t.planes[4*-i],-t.planes[4*-i+1],-t.planes[4*-i+2]):a.push(t.planes[4*i],t.planes[4*i+1],t.planes[4*i+2]),s.push(t.vertices[3*e+0]*t.textureInformation.u[4*m+0]+t.vertices[3*e+1]*t.textureInformation.u[4*m+1]+t.vertices[3*e+2]*t.textureInformation.u[4*m+2]+t.textureInformation.u[4*m+3]),s.push(t.vertices[3*e+0]*t.textureInformation.v[4*m+0]+t.vertices[3*e+1]*t.textureInformation.v[4*m+1]+t.vertices[3*e+2]*t.textureInformation.v[4*m+2]+t.textureInformation.v[4*m+3]),o.push(t.textureInformation.x[m],t.textureInformation.y[m]),r.push(t.textureInformation.w[m],t.textureInformation.h[m])};for(var l=0;l<i.length;l++)!function(e){var i=t.faceEdges[t.faces.edges.offset[e]];i=i<0?t.edges[2*-i+1]:t.edges[2*i];for(var n=1;n<t.faces.edges.size[e]-1;n++){m(i,t.faces.planes[e],t.faces.textureInformation[e]);const a=t.faceEdges[t.faces.edges.offset[e]+n];a<0?(m(t.edges[2*-a+1],t.faces.planes[e],t.faces.textureInformation[e]),m(t.edges[2*-a],t.faces.planes[e],t.faces.textureInformation[e])):(m(t.edges[2*a],t.faces.planes[e],t.faces.textureInformation[e]),m(t.edges[2*a+1],t.faces.planes[e],t.faces.textureInformation[e]))}}(i[l]);this._size=n.length/3,this._vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW),delete n,this._normalBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._normalBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(a),e.STATIC_DRAW),delete a,this._textureCoordinateBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._textureCoordinateBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW),delete s,this._textureOriginBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._textureOriginBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(o),e.STATIC_DRAW),delete o,this._textureSizeBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._textureSizeBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(r),e.STATIC_DRAW),delete r},Quake2.Cluster.prototype.render=function(){const e=this._gl;e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.vertexAttribPointer(0,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._normalBuffer),e.vertexAttribPointer(1,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._textureCoordinateBuffer),e.vertexAttribPointer(2,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._textureOriginBuffer),e.vertexAttribPointer(3,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._textureSizeBuffer),e.vertexAttribPointer(4,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,this._size)},Quake2.PVS={},Quake2.PVS.parse=function(e){const t=e.visibility.map(function(e){const t=window.atob(e),i=new Uint8Array(t.length);for(var n=0;n<t.length;n++)i[n]=t.charCodeAt(n);return i}),i=Object.create(null);for(var n=0;n<t.length;n++){i[n]=[];for(var a=0,s=0;a<t[n].length;a++)if(t[n][a])for(var o=1;o<256;o*=2,s++)t[n][a]&o&&i[n].push(s);else s+=8*t[n][++a]}return i},Quake2.BSP=function(e,t){return this._clusters=Object.create(null),this._mapFaces(t,0),this._createClusters(e,t,0),this._pvs=Quake2.PVS.parse(t),this._parse(t,0)},Quake2.BSP.prototype._mapFaces=function(e,t){if(t<0){const i=-(t+1),n=e.leaves.faces.first[i],a=e.leaves.faces.count[i];if(a>0){const t=e.leaves.faces.table.slice(n,n+a),s=e.leaves.cluster[i];s>=0&&(s in this._clusters||(this._clusters[s]=[]),this._clusters[s]=this._clusters[s].concat(t))}}else this._mapFaces(e,e.nodes.front[t]),this._mapFaces(e,e.nodes.back[t])},Quake2.BSP.prototype._createClusters=function(e,t){for(var i in this._clusters)this._clusters[i]=new Quake2.Cluster(e,t,this._clusters[i])},Quake2.BSP.prototype._getLeafClusters=function(e,t){const i=Object.create(null),n=e.leaves.cluster[t];return n>=0&&this._pvs[n].forEach(function(e){this._clusters[e]&&(i[e]=this._clusters[e])},this),i},Quake2.BSP.prototype._parse=function(e,t){if(t<0){const i=-(t+1);return new Quake2.BSP.Leaf(e,i,this._getLeafClusters(e,i))}return new Quake2.BSP.Node(this,e,t)},Quake2.BSP.Node=function(e,t,i){const n=t.nodes.plane[i];this.plane=t.planes.slice(4*n,4*(n+1)),this.front=e._parse(t,t.nodes.front[i]),this.back=e._parse(t,t.nodes.back[i])},Quake2.BSP.Node.prototype.locate=function(e){return e.x*this.plane[0]+e.y*this.plane[1]+e.z*this.plane[2]-this.plane[3]<0?this.back.locate(e):this.front.locate(e)},Quake2.BSP.Leaf=function(e,t,i){this._clusterIndex=e.leaves.cluster[t],this._clusters=i},Quake2.BSP.Leaf.prototype.locate=function(){return this},Quake2.BSP.Leaf.prototype.views=function(e){return e._clusterIndex in this._clusters},Quake2.BSP.Leaf.prototype.render=function(){for(var e in this._clusters)this._clusters[e].render()},Quake2.Camera=function(e){this._bsp=e,this.position={x:0,y:0,z:0},this.velocity={x:0,y:0,z:0},this.angle={x:0,y:0}},Quake2.Camera.VELOCITY=200,Quake2.Camera.prototype.move=function(e,t){this.velocity.x=e*Math.cos(this.angle.y)+t*-Math.sin(this.angle.y)*Math.cos(this.angle.x),this.velocity.y=t*Math.sin(this.angle.x),this.velocity.z=e*Math.sin(this.angle.y)+t*Math.cos(this.angle.y)*Math.cos(this.angle.x),this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.position.z+=this.velocity.z},Quake2.Camera.prototype.rotate=function(e,t){this.angle.x=Math.min(Math.PI/2,Math.max(-Math.PI/2,this.angle.x+e)),this.angle.y+=t},Quake2.Camera.prototype.tick=function(e,t,i){var n=0,a=0;const s=Quake2.Camera.VELOCITY*(t-e)/1e3;i[65]&&(n-=s),i[68]&&(n+=s),i[83]&&(a-=s),i[87]&&(a+=s),this.move(n,a)},Quake2.WorldProgram=function(e,t,i){this._gl=e,this._camera=i,this._textures={palette:e.createTexture(),atlas:e.createTexture()},e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._textures.palette),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.colormap),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this._textures.atlas),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.texture);const n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,document.getElementById("world-vertex-shader").text),e.compileShader(n),console.log(e.getShaderInfoLog(n));const a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,document.getElementById("world-fragment-shader").text),e.compileShader(a),console.log(e.getShaderInfoLog(a)),this._program=e.createProgram(),e.attachShader(this._program,n),e.attachShader(this._program,a),e.bindAttribLocation(this._program,0,"in_Vertex"),e.bindAttribLocation(this._program,1,"in_Normal"),e.bindAttribLocation(this._program,2,"in_TextureCoordinates"),e.bindAttribLocation(this._program,3,"in_TextureOrigin"),e.bindAttribLocation(this._program,4,"in_TextureSize"),e.linkProgram(this._program),console.log(e.getProgramInfoLog(this._program)),this._locations={screenSize:e.getUniformLocation(this._program,"ScreenSize"),position:e.getUniformLocation(this._program,"Position"),angle:e.getUniformLocation(this._program,"Angle"),atlasSize:e.getUniformLocation(this._program,"AtlasSize"),palette:e.getUniformLocation(this._program,"Palette"),atlas:e.getUniformLocation(this._program,"Atlas")},e.useProgram(this._program),e.uniform2f(this._locations.atlasSize,t.texture.width,t.texture.height),e.uniform1i(this._locations.palette,0),e.uniform1i(this._locations.atlas,1)},Quake2.WorldProgram.prototype.resizeScreen=function(e,t){const i=this._gl;i.useProgram(this._program),i.uniform3f(this._locations.screenSize,e,t,Math.max(e,t))},Quake2.WorldProgram.prototype.prepare=function(){const e=this._gl;e.useProgram(this._program),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._textures.palette),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this._textures.atlas),e.uniform3f(this._locations.position,this._camera.position.x,this._camera.position.y,this._camera.position.z),e.uniform2f(this._locations.angle,this._camera.angle.x,this._camera.angle.y)},Quake2.ModelProgram=function(e,t){this._gl=e,this._camera=t;const i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,document.getElementById("model-vertex-shader").text),e.compileShader(i),console.log(e.getShaderInfoLog(i));const n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,document.getElementById("model-fragment-shader").text),e.compileShader(n),console.log(e.getShaderInfoLog(n)),this._program=e.createProgram(),e.attachShader(this._program,i),e.attachShader(this._program,n),e.bindAttribLocation(this._program,0,"in_PreviousVertex"),e.bindAttribLocation(this._program,1,"in_NextVertex"),e.bindAttribLocation(this._program,2,"in_PreviousNormal"),e.bindAttribLocation(this._program,3,"in_NextNormal"),e.bindAttribLocation(this._program,4,"in_TextureCoordinates"),e.linkProgram(this._program),console.log(e.getProgramInfoLog(this._program)),this.locations={camera:{position:e.getUniformLocation(this._program,"Camera.Position"),angle:e.getUniformLocation(this._program,"Camera.Angle")},position:e.getUniformLocation(this._program,"Position"),angle:e.getUniformLocation(this._program,"Angle"),texture:e.getUniformLocation(this._program,"Texture"),step:e.getUniformLocation(this._program,"Step"),screenSize:e.getUniformLocation(this._program,"ScreenSize")},e.useProgram(this._program),e.uniform1i(this.locations.texture,2)},Quake2.ModelProgram.prototype.resizeScreen=function(e,t){const i=this._gl;i.useProgram(this._program),i.uniform3f(this.locations.screenSize,e,t,Math.max(e,t))},Quake2.ModelProgram.prototype.prepareForEntities=function(){const e=this._gl;e.useProgram(this._program),e.uniform3f(this.locations.camera.position,this._camera.position.x,this._camera.position.y,this._camera.position.z),e.uniform2f(this.locations.camera.angle,this._camera.angle.x,this._camera.angle.y),e.activeTexture(e.TEXTURE2)},Quake2.ModelProgram.prototype.prepareForWeapon=function(){const e=this._gl;e.uniform3f(this.locations.camera.position,0,0,0),e.uniform2f(this.locations.camera.angle,0,0)},Quake2.BaseModel=function(e,t,i,n,a,s){this._gl=e,this._program=t,this.name=i,this.animations=Quake2.BaseModel._loadAnimations(n),this._vertexBuffer=e.createBuffer(),this._normalBuffer=e.createBuffer(),this._textureCoordinateBuffer=e.createBuffer(),this._size=n.triangles.vertices.length;const o=new Float32Array(n.frames.names.length*n.triangles.vertices.length*3);for(u=0;u<n.frames.names.length;u++)for(m=0;m<n.triangles.vertices.length;m++)o[3*(u*n.triangles.vertices.length+m)+0]=n.frames.vertices[3*(u*n.frames.vertexCount+n.triangles.vertices[m])+0]*n.frames.scale[3*u+0]+n.frames.translate[3*u+0],o[3*(u*n.triangles.vertices.length+m)+2]=n.frames.vertices[3*(u*n.frames.vertexCount+n.triangles.vertices[m])+1]*n.frames.scale[3*u+1]+n.frames.translate[3*u+1],o[3*(u*n.triangles.vertices.length+m)+1]=n.frames.vertices[3*(u*n.frames.vertexCount+n.triangles.vertices[m])+2]*n.frames.scale[3*u+2]+n.frames.translate[3*u+2];e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,o,e.STATIC_DRAW),delete o;const r=new Float32Array(n.frames.names.length*n.triangles.vertices.length*3);for(u=0;u<n.frames.names.length;u++)for(var m=0;m<n.triangles.vertices.length;m++){const e=s[n.frames.normals[u*n.frames.vertexCount+n.triangles.vertices[m]]];r[3*(u*n.triangles.vertices.length+m)+0]=e[0],r[3*(u*n.triangles.vertices.length+m)+2]=e[1],r[3*(u*n.triangles.vertices.length+m)+1]=e[2]}e.bindBuffer(e.ARRAY_BUFFER,this._normalBuffer),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW),delete r;const l=new Float32Array(2*n.triangles.textureCoordinates.length);for(var u=0;u<n.triangles.textureCoordinates.length;u++){const e=2*n.triangles.textureCoordinates[u];l[2*u+0]=n.textureCoordinates[e+0]/n.skin.width,l[2*u+1]=n.textureCoordinates[e+1]/n.skin.height}e.bindBuffer(e.ARRAY_BUFFER,this._textureCoordinateBuffer),e.bufferData(e.ARRAY_BUFFER,l,e.STATIC_DRAW),delete l,this._textures={},e.activeTexture(e.TEXTURE2);for(var i in a)this._textures[i]=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._textures[i]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a[i])},Quake2.BaseModel._loadAnimations=function(e){const t=Object.create(null);e.frames.names.forEach(function(e,i){const n=/^([a-z_]+)(\d*)$/.exec(e);n&&(n[1]in t||(t[n[1]]=Object.create(null)),t[n[1]][n[2]]=i)});for(var i in t)t[i]=Object.keys(t[i]).sort().map(function(e){return t[i][e]});return t},Quake2.BaseModel.prototype.render=function(e,t,i,n,a,s,o,r){const m=this._gl,l=this._program;m.uniform3f(l.locations.position,e,t,i),m.uniform1f(l.locations.angle,n),m.uniform1f(l.locations.step,o),m.bindBuffer(m.ARRAY_BUFFER,this._vertexBuffer),m.vertexAttribPointer(0,3,m.FLOAT,!1,0,12*this._size*a),m.vertexAttribPointer(1,3,m.FLOAT,!1,0,12*this._size*s),m.bindBuffer(m.ARRAY_BUFFER,this._normalBuffer),m.vertexAttribPointer(2,3,m.FLOAT,!1,0,12*this._size*a),m.vertexAttribPointer(3,3,m.FLOAT,!1,0,12*this._size*s),m.bindBuffer(m.ARRAY_BUFFER,this._textureCoordinateBuffer),m.vertexAttribPointer(4,2,m.FLOAT,!1,0,0),m.bindTexture(m.TEXTURE_2D,this._textures[r]),m.drawArrays(m.TRIANGLES,0,this._size)},Quake2.AnimatedModel=function(e){this._model=e,this._animation=null},Quake2.AnimatedModel.FRAME_DURATION=100,Quake2.AnimatedModel.prototype.setSkin=function(e){this._skin=e},Quake2.AnimatedModel.prototype.play=function(e){this._animation={name:e,firstFrame:0,lastFrame:this._model.animations[e].length-1,startTime:Date.now()}},Quake2.AnimatedModel.prototype.playFrames=function(e,t,i){this._animation={name:e,firstFrame:t,lastFrame:i,startTime:Date.now()}},Quake2.AnimatedModel.prototype.stop=function(){this._animation=null},Quake2.AnimatedModel.prototype.render=function(e,t,i,n,a){if(this._animation){const s=this._model.animations[this._animation.name],o=a-this._animation.startTime,r=Math.floor(o/Quake2.AnimatedModel.FRAME_DURATION),m=this._animation.lastFrame-this._animation.firstFrame+1,l=s[this._animation.firstFrame+r%m],u=s[this._animation.firstFrame+(r+1)%m],c=o/Quake2.AnimatedModel.FRAME_DURATION%r;this._model.render(e,t,i,n,l,u,c,this._skin)}},Quake2.PositionedModel=function(e,t,i){Quake2.AnimatedModel.call(this,e),this.position=t,this.angle=i},Quake2.inherit(Quake2.AnimatedModel,Quake2.PositionedModel),Quake2.PositionedModel.prototype.render=function(e){Quake2.AnimatedModel.prototype.render.call(this,this.position.x,this.position.y,this.position.z,this.angle,e)},Quake2.ModelFactory=function(e,t,i,n){this._baseModels=Object.create(null);for(var a in i)this._baseModels[a]=new Quake2.BaseModel(e,t,a,i[a].data,i[a].skins,n);this.models=[]},Quake2.ModelFactory.prototype.create=function(e){if(e in this._baseModels){const t=this._baseModels[e];return new Quake2.AnimatedModel(t)}throw new Error('unknown model "'+e+'"')},Quake2.ModelFactory.prototype.spawn=function(e,t,i){if(e in this._baseModels){const n=this._baseModels[e],a=new Quake2.PositionedModel(n,t,i);return this.models.push(a),a}throw new Error('unknown model "'+e+'"')},Quake2.Weapons={},Quake2.Weapons.Blaster=function(e){this._model=e.create("weapons/v_blast"),this._model.setSkin("models/weapons/v_blast/skin"),this._model.play("idle")},Quake2.Weapons.Blaster.prototype.render=function(e){this._model.render(0,0,0,Math.PI/2,e)},Quake2.Entities.Barrel=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("objects/barrels",i,n),this._model.setSkin("models/objects/barrels/skin"),this._model.playFrames("barrel",0,0)},Quake2.Entities.Barrel.MODELS=["objects/barrels"],Quake2.Entities.Barrel.prototype.tick=function(){},Quake2.Entities.dictionary.misc_explobox=Quake2.Entities.Barrel,Quake2.Entities.Berserk=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/berserk",i,n),this._model.setSkin("models/monsters/berserk/skin"),this._model.play("stand")},Quake2.Entities.Berserk.MODELS=["monsters/berserk"],Quake2.Entities.Berserk.prototype.tick=function(){},Quake2.Entities.dictionary.monster_berserk=Quake2.Entities.Berserk,Quake2.Entities.Boss2=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/boss2",i,n),this._model.setSkin("models/monsters/boss2/skin"),this._model.play("stand")},Quake2.Entities.Boss2.MODELS=["monsters/boss2"],Quake2.Entities.Boss2.prototype.tick=function(){},Quake2.Entities.dictionary.monster_boss2=Quake2.Entities.Boss2,Quake2.Entities.Jorg=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/boss3/jorg",i,n),this._model.setSkin("models/monsters/boss3/jorg/skin"),this._model.play("stand")},Quake2.Entities.Jorg.MODELS=["monsters/boss3/jorg","monsters/boss3/rider"],Quake2.Entities.Jorg.prototype.tick=function(){},Quake2.Entities.dictionary.monster_jorg=Quake2.Entities.Jorg,Quake2.Entities.Rider=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/boss3/rider",i,n),this._model.setSkin("models/monsters/boss3/rider/skin"),this._model.play("stand")},Quake2.Entities.Rider.MODELS=["monsters/boss3/rider"],Quake2.Entities.Rider.prototype.tick=function(){},Quake2.Entities.dictionary.monster_boss3_stand=Quake2.Entities.Rider,Quake2.Entities.Brain=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/brain",i,n),this._model.setSkin("models/monsters/brain/skin"),this._model.play("stand")},Quake2.Entities.Brain.MODELS=["monsters/brain"],Quake2.Entities.Brain.prototype.tick=function(){},Quake2.Entities.dictionary.monster_brain=Quake2.Entities.Brain,Quake2.Entities.Chick=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/bitch",i,n),this._model.setSkin("models/monsters/bitch/skin"),this._model.play("stand")},Quake2.Entities.Chick.MODELS=["monsters/bitch"],Quake2.Entities.Chick.prototype.tick=function(){},Quake2.Entities.dictionary.monster_chick=Quake2.Entities.Chick,Quake2.Entities.DeadBody=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("deadbods/dude",i,n),this._model.setSkin("models/deadbods/dude/dead1");var a;a=2&t.spawnflags?1:4&t.spawnflags?2:8&t.spawnflags?3:16&t.spawnflags?4:32&t.spawnflags?5:0,this._model.playFrames("body",a,a)},Quake2.Entities.DeadBody.MODELS=["deadbods/dude"],Quake2.Entities.DeadBody.prototype.tick=function(){},Quake2.Entities.dictionary.misc_deadsoldier=Quake2.Entities.DeadBody,Quake2.Entities.Floater=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/float",i,n),this._model.setSkin("models/monsters/float/skin"),this._model.play("stand")},Quake2.Entities.Floater.MODELS=["monsters/float"],Quake2.Entities.Floater.prototype.tick=function(){},Quake2.Entities.dictionary.monster_floater=Quake2.Entities.Floater,Quake2.Entities.Flyer=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/flyer",i,n),this._model.setSkin("models/monsters/flyer/skin"),this._model.play("stand")},Quake2.Entities.Flyer.MODELS=["monsters/flyer"],Quake2.Entities.Flyer.prototype.tick=function(){},Quake2.Entities.dictionary.monster_flyer=Quake2.Entities.Flyer,Quake2.Entities.Gladiator=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/gladiatr",i,n),this._model.setSkin("models/monsters/gladiatr/skin"),this._model.play("stand")},Quake2.Entities.Gladiator.MODELS=["monsters/gladiatr"],Quake2.Entities.Gladiator.prototype.tick=function(){},Quake2.Entities.dictionary.monster_gladiator=Quake2.Entities.Gladiator,Quake2.Entities.Gunner=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/gunner",i,n),this._model.setSkin("models/monsters/gunner/skin"),this._model.play("stand")},Quake2.Entities.Gunner.MODELS=["monsters/gunner"],Quake2.Entities.Gunner.prototype.tick=function(){},Quake2.Entities.dictionary.monster_gunner=Quake2.Entities.Gunner,Quake2.Entities.Hover=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/hover",i,n),this._model.setSkin("models/monsters/hover/skin"),this._model.play("stand")},Quake2.Entities.Hover.MODELS=["monsters/hover"],Quake2.Entities.Hover.prototype.tick=function(){},Quake2.Entities.dictionary.monster_hover=Quake2.Entities.Hover,Quake2.Entities.Infantry=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/infantry",i,n),this._model.setSkin("models/monsters/infantry/skin"),this._model.playFrames("stand",48,70)},Quake2.Entities.Infantry.MODELS=["monsters/infantry"],Quake2.Entities.Infantry.prototype.tick=function(){},Quake2.Entities.dictionary.monster_infantry=Quake2.Entities.Infantry,Quake2.Entities.Medic=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/medic",i,n),this._model.setSkin("models/monsters/medic/skin"),this._model.play("wait")},Quake2.Entities.Medic.MODELS=["monsters/medic"],Quake2.Entities.Medic.prototype.tick=function(){},Quake2.Entities.dictionary.monster_medic=Quake2.Entities.Medic,Quake2.Entities.Mutant=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/mutant",i,n),this._model.setSkin("models/monsters/mutant/skin"),this._model.play("stand")},Quake2.Entities.Mutant.MODELS=["monsters/mutant"],Quake2.Entities.Mutant.prototype.tick=function(){},Quake2.Entities.dictionary.monster_mutant=Quake2.Entities.Mutant,Quake2.Entities.Parasite=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/parasite",i,n),this._model.setSkin("models/monsters/parasite/skin"),this._model.play("stand")},Quake2.Entities.Parasite.MODELS=["monsters/parasite","monsters/parasite/segment","monsters/parasite/tip"],Quake2.Entities.Parasite.prototype.tick=function(){},Quake2.Entities.dictionary.monster_parasite=Quake2.Entities.Parasite,Quake2.Entities.Soldier=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;switch(this._model=e.spawn("monsters/soldier",i,n),t.classname){case"monster_soldier_light":this._model.setSkin("models/monsters/soldier/skin_lt"),this._model.playFrames("stand",0,29);break;case"monster_soldier_ss":this._model.setSkin("models/monsters/soldier/skin_ss"),this._model.playFrames("stand",30,68);break;default:this._model.setSkin("models/monsters/soldier/skin"),this._model.playFrames("stand",30,68)}},Quake2.Entities.Soldier.MODELS=["monsters/soldier"],Quake2.Entities.Soldier.prototype.tick=function(){},Quake2.Entities.dictionary.monster_soldier=Quake2.Entities.Soldier,Quake2.Entities.dictionary.monster_soldier_light=Quake2.Entities.Soldier,Quake2.Entities.dictionary.monster_soldier_ss=Quake2.Entities.Soldier,Quake2.Entities.Static=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn(Quake2.Entities.Static._MODEL_MAP[t.classname],i,n),this._model.setSkin(Quake2.Entities.Static._SKIN_MAP[t.classname]),this._model.play(Quake2.Entities.Static._ANIMATION_MAP[t.classname])},Quake2.Entities.Static._MODEL_MAP={ammo_bullets:"items/ammo/bullets/medium",ammo_cells:"items/ammo/cells/medium",ammo_grenades:"items/ammo/grenades/medium",ammo_rockets:"items/ammo/rockets/medium",ammo_shells:"items/ammo/shells/medium",ammo_slugs:"items/ammo/slugs/medium",item_adrenaline:"items/adrenal",item_armor_combat:"items/armor/combat",item_armor_jacket:"items/armor/jacket",item_armor_shard:"items/armor/shard",item_breather:"items/breather",item_enviro:"items/enviro",item_health:"items/healing/stimpack",item_health_large:"items/healing/large",item_health_mega:"items/mega_h",item_health_small:"items/healing/medium",item_invulnerability:"items/invulner",item_pack:"items/pack",item_quad:"items/quaddama",item_silencer:"items/silencer",misc_banner:"objects/banner",misc_gib_head:"objects/gibs/head",weapon_bfg:"weapons/g_bfg",weapon_chaingun:"weapons/g_chain",weapon_grenadelauncher:"weapons/g_launch",weapon_hyperblaster:"weapons/g_hyperb",weapon_machinegun:"weapons/g_machn",weapon_railgun:"weapons/g_rail",weapon_rocketlauncher:"weapons/g_rocket",weapon_shotgun:"weapons/g_shotg",weapon_supershotgun:"weapons/g_shotg2"},Quake2.Entities.Static._SKIN_MAP={ammo_bullets:"models/items/ammo/bullets/medium/skin",ammo_cells:"models/items/ammo/cells/medium/skin",ammo_grenades:"models/items/ammo/grenades/medium/skin",ammo_rockets:"models/items/ammo/rockets/medium/skin",ammo_shells:"models/items/ammo/shells/medium/skin",ammo_slugs:"models/items/ammo/slugs/medium/skin",item_adrenaline:"models/items/adrenal/skin",item_armor_combat:"models/items/armor/combat/skin",item_armor_jacket:"models/items/armor/jacket/skin",item_armor_shard:"models/items/armor/shard/skin",item_breather:"models/items/breather/skin",item_enviro:"models/items/enviro/skin",item_health:"models/items/healing/stimpack/skin",item_health_large:"models/items/healing/large/skin",item_health_mega:"models/items/mega_h/skin",item_health_small:"models/items/healing/medium/skin",item_invulnerability:"models/items/invulner/skin",item_pack:"models/items/pack/skin",item_quad:"models/items/quaddama/skin",item_silencer:"models/items/silencer/skin",misc_banner:"models/objects/banner/skin",misc_gib_head:"models/objects/gibs/head/skin",weapon_bfg:"models/weapons/g_bfg/skin",weapon_chaingun:"models/weapons/g_chain/skin",weapon_grenadelauncher:"models/weapons/g_launch/skin",weapon_hyperblaster:"models/weapons/g_hyperb/skin",weapon_machinegun:"models/weapons/g_machn/skin",weapon_railgun:"models/weapons/g_rail/skin",weapon_rocketlauncher:"models/weapons/g_rocket/skin",weapon_shotgun:"models/weapons/g_shotg/skin",weapon_supershotgun:"models/weapons/g_shotg2/skin"},Quake2.Entities.Static._ANIMATION_MAP={ammo_bullets:"bullets",ammo_cells:"cells",ammo_grenades:"grenade",ammo_rockets:"rockets",ammo_shells:"shells",ammo_slugs:"slugs",item_adrenaline:"adrenal",item_armor_combat:"combat",item_armor_jacket:"armor",item_armor_shard:"shard",item_breather:"breather",item_enviro:"enviro",item_health:"stimpack",item_health_large:"large",item_health_mega:"mega",item_health_small:"medium",item_invulnerability:"invulner",item_pack:"pack",item_quad:"quaddama",item_silencer:"silencer",misc_banner:"frame",misc_gib_head:"head",weapon_bfg:"g_bfg",weapon_chaingun:"g_chain",weapon_grenadelauncher:"g_launch",weapon_hyperblaster:"g_hyperb",weapon_machinegun:"g_machn",weapon_railgun:"g_rail",weapon_rocketlauncher:"g_rocket",weapon_shotgun:"g_shotd",weapon_supershotgun:"g_shotg"},Quake2.Entities.Static.MODELS=["items/ammo/bullets/medium","items/ammo/cells/medium","items/ammo/grenades/medium","items/ammo/rockets/medium","items/ammo/shells/medium","items/ammo/slugs/medium","items/adrenal","items/armor/combat","items/armor/jacket","items/armor/shard","items/breather","items/enviro","items/healing/stimpack","items/healing/large","items/mega_h","items/healing/medium","items/invulner","items/pack","items/quaddama","items/silencer","objects/banner","objects/gibs/head","weapons/g_bfg","weapons/g_chain","weapons/g_launch","weapons/g_hyperb","weapons/g_machn","weapons/g_rail","weapons/g_rocket","weapons/g_shotg","weapons/g_shotg2"],Quake2.Entities.Static.prototype.tick=function(){},Quake2.Entities.dictionary.ammo_bullets=Quake2.Entities.Static,Quake2.Entities.dictionary.ammo_cells=Quake2.Entities.Static,Quake2.Entities.dictionary.ammo_grenades=Quake2.Entities.Static,Quake2.Entities.dictionary.ammo_rockets=Quake2.Entities.Static,Quake2.Entities.dictionary.ammo_shells=Quake2.Entities.Static,Quake2.Entities.dictionary.ammo_slugs=Quake2.Entities.Static,Quake2.Entities.dictionary.item_adrenaline=Quake2.Entities.Static,Quake2.Entities.dictionary.item_armor_combat=Quake2.Entities.Static,Quake2.Entities.dictionary.item_armor_jacket=Quake2.Entities.Static,Quake2.Entities.dictionary.item_armor_shard=Quake2.Entities.Static,Quake2.Entities.dictionary.item_breather=Quake2.Entities.Static,Quake2.Entities.dictionary.item_enviro=Quake2.Entities.Static,Quake2.Entities.dictionary.item_health=Quake2.Entities.Static,Quake2.Entities.dictionary.item_health_large=Quake2.Entities.Static,Quake2.Entities.dictionary.item_health_mega=Quake2.Entities.Static,Quake2.Entities.dictionary.item_health_small=Quake2.Entities.Static,Quake2.Entities.dictionary.item_invulnerability=Quake2.Entities.Static,Quake2.Entities.dictionary.item_pack=Quake2.Entities.Static,Quake2.Entities.dictionary.item_quad=Quake2.Entities.Static,Quake2.Entities.dictionary.item_silencer=Quake2.Entities.Static,Quake2.Entities.dictionary.misc_banner=Quake2.Entities.Static,Quake2.Entities.dictionary.misc_gib_head=Quake2.Entities.Static,Quake2.Entities.dictionary.weapon_bfg=Quake2.Entities.Static,Quake2.Entities.dictionary.weapon_chaingun=Quake2.Entities.Static,Quake2.Entities.dictionary.weapon_grenadelauncher=Quake2.Entities.Static,Quake2.Entities.dictionary.weapon_hyperblaster=Quake2.Entities.Static,Quake2.Entities.dictionary.weapon_machinegun=Quake2.Entities.Static,Quake2.Entities.dictionary.weapon_railgun=Quake2.Entities.Static,Quake2.Entities.dictionary.weapon_rocketlauncher=Quake2.Entities.Static,Quake2.Entities.dictionary.weapon_shotgun=Quake2.Entities.Static,Quake2.Entities.dictionary.weapon_supershotgun=Quake2.Entities.Static,Quake2.Entities.SuperTank=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;this._model=e.spawn("monsters/boss1",i,n),this._model.setSkin("models/monsters/boss1/skin"),this._model.play("stand")},Quake2.Entities.SuperTank.MODELS=["monsters/boss1"],Quake2.Entities.SuperTank.prototype.tick=function(){},Quake2.Entities.dictionary.monster_supertank=Quake2.Entities.SuperTank,Quake2.Entities.Tank=function(e,t){const i={x:t.origin[0],y:t.origin[1],z:t.origin[2]},n=t.angle||0;switch(this._model=e.spawn("monsters/tank",i,n),t.classname){case"monster_tank_commander":this._model.setSkin("models/monsters/tank/../ctank/skin");break;default:this._model.setSkin("models/monsters/tank/skin")}this._model.play("stand")},Quake2.Entities.Tank.MODELS=["monsters/tank"],Quake2.Entities.Tank.prototype.tick=function(){},Quake2.Entities.dictionary.monster_tank=Quake2.Entities.Tank,Quake2.Entities.dictionary.monster_tank_commander=Quake2.Entities.Tank,Quake2.Game=function(e,t){this._gl=e,e.clearColor(0,0,0,1),e.enable(e.DEPTH_TEST),e.clearDepth(0),e.depthFunc(e.GREATER),e.enable(e.CULL_FACE),e.frontFace(e.CW),e.enableVertexAttribArray(0),e.enableVertexAttribArray(1),e.enableVertexAttribArray(2),e.enableVertexAttribArray(3),e.enableVertexAttribArray(4),this._bsp=new Quake2.BSP(e,t.data),this.camera=new Quake2.Camera(this._bsp),this._worldProgram=new Quake2.WorldProgram(e,t,this.camera),this._modelProgram=new Quake2.ModelProgram(e,this.camera),this._modelFactory=new Quake2.ModelFactory(e,this._modelProgram,t.models,t.normals),this.weapon=new Quake2.Weapons.Blaster(this._modelFactory),this.entities=t.data.entities.filter(function(e){return e.classname in Quake2.Entities.dictionary}).map(function(e){return new(0,Quake2.Entities.dictionary[e.classname])(this._modelFactory,e)},this),t.data.entities.filter(function(e){return"info_player_start"===e.classname}).forEach(function(e){this.camera.position.x=e.origin[0],this.camera.position.y=e.origin[1]+25,this.camera.position.z=e.origin[2],this.camera.angle.y=e.angle-Math.PI/2},this)},Quake2.Game.prototype.resize=function(e,t){this._gl.viewport(0,0,e,t),this._worldProgram.resizeScreen(e,t),this._modelProgram.resizeScreen(e,t)},Quake2.Game.prototype.tick=function(e,t,i){this.camera.tick(e,t,i)},Quake2.Game.prototype.render=function(){const e=this._gl;e.clear(e.DEPTH_BUFFER_BIT);const t=Date.now();this._worldProgram.prepare();const i=this._bsp.locate(this.camera.position);i.render(),this._modelProgram.prepareForEntities();for(var n=0;n<this._modelFactory.models.length;n++){const e=this._modelFactory.models[n],a=this._bsp.locate(e.position);i.views(a)&&e.render(t)}this._modelProgram.prepareForWeapon(),this.weapon.render(t),e.flush()},$(function(){const e=document.getElementById("canvas"),t=e.getContext("webgl");(new Quake2.Loader).loadMap("base1").then(function(i){const n=new Quake2.Game(t,i),a=Object.create(null);var s;const o=function(){s=Math.max(window.innerWidth,window.innerHeight);const t=.75*window.innerWidth,i=.75*window.innerHeight;e.width=t,e.height=i,n.resize(t,i)};o();var r=Date.now();window.setInterval(function(){const e=Date.now();n.tick(r,e,a),r=e},33),$(e).on("click",function(){e.requestPointerLock()}),e.addEventListener("mousemove",function(e){n.camera.rotate(2*-(e.movementY||0)/s,2*-(e.movementX||0)/s)},!0),$(window).on("resize",function(){o()}).on("keydown",function(e){a[e.which]=!0}).on("keyup",function(e){a[e.which]=!1}),function e(){n.render(),window.requestAnimationFrame(e)}()})});</script></head><body><canvas id=canvas></canvas><script id=world-vertex-shader type=application/glsl>uniform vec3 Position; uniform vec2 Angle; uniform vec3 ScreenSize; attribute vec3 in_Vertex; attribute vec3 in_Normal; attribute vec2 in_TextureCoordinates; attribute vec2 in_TextureOrigin; attribute vec2 in_TextureSize; const float PI = acos(-1.0); const vec3 Light = normalize(vec3(1, 2, 3)); varying float ex_Brightness; varying vec2 ex_TextureCoordinates; varying vec2 ex_TextureOrigin; varying vec2 ex_TextureSize; void main() { ex_Brightness = 1.0 - abs(acos(dot(Light, in_Normal))) / PI; ex_TextureCoordinates = in_TextureCoordinates; ex_TextureOrigin = in_TextureOrigin; ex_TextureSize = in_TextureSize; vec4 Vertex = vec4(in_Vertex, 1); gl_Position = mat4( ScreenSize.z / ScreenSize.x, 0, 0, 0, 0, ScreenSize.z / ScreenSize.y, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1 ) * mat4( 1, 0, 0, 0, 0, cos(Angle.x), sin(Angle.x), 0, 0, -sin(Angle.x), cos(Angle.x), 0, 0, 0, 0, 1 ) * mat4( cos(Angle.y), 0, -sin(Angle.y), 0, 0, 1, 0, 0, sin(Angle.y), 0, cos(Angle.y), 0, 0, 0, 0, 1 ) * mat4( 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -Position, 1 ) * vec4(in_Vertex, 1); }</script><script id=world-fragment-shader type=application/glsl>precision mediump float; uniform sampler2D Palette; uniform sampler2D Atlas; uniform vec2 AtlasSize; varying float ex_Brightness; varying vec2 ex_TextureCoordinates; varying vec2 ex_TextureOrigin; varying vec2 ex_TextureSize; vec2 mod2(vec2 a, vec2 b) { return mod(mod(a, b) + b, b); } void main() { vec2 TextureCoordinates = ex_TextureOrigin + mod2( ex_TextureCoordinates, ex_TextureSize ); float Index = texture2D(Atlas, TextureCoordinates / AtlasSize).r; vec4 Color = texture2D(Palette, vec2(Index, 0.002)); gl_FragColor = vec4(vec3(Color) * ex_Brightness, Color.a); }</script><script id=model-vertex-shader type=application/glsl>uniform struct { vec3 Position; vec2 Angle; } Camera; uniform vec3 Position; uniform float Angle; uniform float Step; uniform vec3 ScreenSize; attribute vec3 in_PreviousVertex; attribute vec3 in_NextVertex; attribute vec3 in_PreviousNormal; attribute vec3 in_NextNormal; attribute vec2 in_TextureCoordinates; const float PI = acos(-1.0); const vec3 Light = normalize(vec3(1, 2, 3)); varying float ex_Brightness; varying vec2 ex_TextureCoordinates; void main() { vec3 Normal = mat3( cos(Angle), 0, sin(Angle), 0, 1, 0, -sin(Angle), 0, cos(Angle) ) * mix(in_PreviousNormal, in_NextNormal, Step); ex_Brightness = 1.0 - abs(acos(dot(Light, Normal))) / PI; ex_TextureCoordinates = in_TextureCoordinates; gl_Position = mat4( ScreenSize.z / ScreenSize.x, 0, 0, 0, 0, ScreenSize.z / ScreenSize.y, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1 ) * mat4( 1, 0, 0, 0, 0, cos(Camera.Angle.x), sin(Camera.Angle.x), 0, 0, -sin(Camera.Angle.x), cos(Camera.Angle.x), 0, 0, 0, 0, 1 ) * mat4( cos(Camera.Angle.y), 0, -sin(Camera.Angle.y), 0, 0, 1, 0, 0, sin(Camera.Angle.y), 0, cos(Camera.Angle.y), 0, 0, 0, 0, 1 ) * mat4( 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, Position - Camera.Position, 1 ) * mat4( cos(Angle), 0, sin(Angle), 0, 0, 1, 0, 0, -sin(Angle), 0, cos(Angle), 0, 0, 0, 0, 1 ) * vec4(mix(in_PreviousVertex, in_NextVertex, Step), 1); }</script><script id=model-fragment-shader type=application/glsl>precision mediump float; uniform sampler2D Texture; varying float ex_Brightness; varying vec2 ex_TextureCoordinates; void main() { vec4 Color = texture2D(Texture, ex_TextureCoordinates); gl_FragColor = vec4(vec3(Color) * ex_Brightness, Color.a); }</script></body></html>